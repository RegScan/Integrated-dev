# 前端管理界面 (web-admin)

**功能职责：**

本项目是基于Vue.js和Vite构建的单页面应用（SPA），为内容合规检测系统提供一个现代、响应式的Web管理后台。用户可以通过此界面进行系统配置、任务管理、查看扫描结果和处理告警。

## 新增功能特性

### 🖥️ 系统概览
- **仪表盘** - 实时系统状态监控，包含内存使用情况概览
- **内存监控** - 详细的内存使用情况和优化配置（新增）
- **扫描管理** - 网站扫描任务管理
- **告警中心** - 系统告警和处置
- **配置中心** - 系统配置管理

### 📊 内存监控功能（新增）
- **实时监控** - 内存使用率、浏览器实例、缓存命中率
- **趋势分析** - 24小时内存使用趋势图
- **服务详情** - 各服务的内存使用情况
- **告警历史** - 内存告警记录和处理状态
- **优化配置** - 内存阈值、清理间隔等参数设置

### 🛡️ 安全防护（新增）
- **OOM防护** - 内存泄漏检测和自动清理
- **资源管理** - 浏览器实例池管理和自动释放
- **告警机制** - 多级别内存告警和自动处置

## 技术栈

- **框架**: Vue.js (版本3)
- **构建工具**: Vite
- **UI组件库**: Element Plus (或Ant Design Vue等)
- **路由**: Vue Router
- **状态管理**: Pinia (或Vuex)
- **HTTP客户端**: Axios
- **图表**: ECharts
- **内存监控**: 实时内存使用监控和优化配置

## 目录结构说明

- `public/`: 存放静态资源，如`index.html`、`favicon.ico`。此目录下的文件不会被Vite处理，会直接被复制到输出目录的根目录。
- `src/`: 项目的核心源代码目录。
  - `api/`: 存放所有与后端API交互的请求模块。每个文件对应一个后瑞模块，如`scan.js`, `alert.js`, `memory.js`（新增内存监控API）。
  - `assets/`: 存放需要被Vite处理的静态资源，如CSS、图片、字体文件。
  - `components/`: 存放可复用的Vue组件。
    - `common/`: 通用基础组件（如自定义按钮、模态框）。
    - `charts/`: 图表组件。
    - `forms/`: 表单相关组件。
  - `router/`: 配置Vue Router，定义应用的页面路由。
  - `store/`: 配置Pinia，定义全局状态模块（如用户信息、权限等）。
  - `utils/`: 存放工具函数模块，如`request.js`（封装Axios）、`auth.js`（处理Token）。
  - `views/`: 存放页面级Vue组件，每个文件对应一个路由页面，如`Dashboard.vue`, `ScanManagement.vue`, `MemoryMonitor.vue`（新增内存监控页面）。
  - `App.vue`: 应用的根组件。
  - `main.js`: 应用的入口文件，负责创建Vue实例、挂载路由、状态管理等。
- `tests/`: 存放前端测试代码（如使用Vitest, Jest）。
- `package.json`: 项目元数据和依赖管理文件。
- `vite.config.js`: Vite的配置文件，用于配置开发服务器、构建选项、代理等。
- `Dockerfile`: 用于构建前端应用的Docker镜像（通常使用Nginx作为Web服务器）。
- `README.md`: 项目说明文档。

## 开发规范

- **组件化开发**: 将UI拆分为独立的、可复用的组件。
- **API封装**: 在`api/`目录中集中管理所有后端请求，不要在Vue组件中直接硬编码URL。
- **状态管理**: 使用Pinia管理全局或跨组件共享的状态，如用户信息、权限令牌。
- **路由懒加载**: 为`views`下的页面组件配置路由懒加载，优化首屏加载速度。
- **代码风格**: 使用ESLint和Prettier来统一代码风格，并配置Git钩子在提交前自动格式化。
- **环境变量**: 使用`.env`文件（如`.env.development`, `.env.production`）来管理不同环境下的配置（如API基础路径）。
- **代理配置**: 在`vite.config.js`中配置开发服务器代理，解决本地开发时的跨域问题。
- **内存监控**: 实时监控系统内存使用情况，防止OOM和内存泄漏。

## 内存监控功能详解

### 实时监控指标
- **总内存使用率** - 系统整体内存使用情况，超过阈值自动告警
- **浏览器实例数** - 活跃的Playwright浏览器实例，防止内存泄漏
- **缓存命中率** - Redis缓存使用效率，优化缓存策略
- **垃圾回收频率** - 内存清理频率，监控GC性能

### 监控图表功能
- **内存趋势图** - 24小时内存使用趋势，支持实时更新
- **内存分布图** - 各服务内存使用分布，饼图展示
- **告警历史** - 内存告警记录和处理状态，支持筛选

### 优化配置功能
- **内存阈值** - 设置内存使用警告阈值（默认80%）
- **清理间隔** - 自动清理任务间隔（默认300秒）
- **并发控制** - 最大并发扫描数（默认5个）
- **浏览器限制** - 单个浏览器内存限制（默认512MB）

### API接口说明
```javascript
// 获取内存指标
GET /api/v1/memory/metrics

// 获取服务内存数据
GET /api/v1/memory/services

// 获取告警历史
GET /api/v1/memory/alerts

// 获取优化配置
GET /api/v1/memory/config

// 保存优化配置
POST /api/v1/memory/config

// 强制清理服务内存
POST /api/v1/memory/cleanup/{service_name}
```

### 安全防护机制
- **OOM防护** - 内存使用率超过95%时自动拒绝新请求
- **资源管理** - 浏览器实例池管理，自动释放空闲实例
- **自动清理** - 定期执行垃圾回收和缓存清理
- **告警机制** - 多级别告警（warning/critical/emergency）